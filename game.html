<!DOCTYPE html>
<html>
	
	<head>
		<meta charset="UTF-8">
		<title>Sprite</title>
	</head>
	
	<body>
		<div style = "text-align:center;">
			<canvas id="myCanvas" width="1500" height="666" style="border:solid 3px purple">
				Your browser does not support HTML5 Canvas.
			</canvas>
		</div>
	<script>
		const canvas = document.querySelector('#myCanvas');
		const ctx = canvas.getContext("2d");
		
		const W = canvas.width, H = canvas.height;

		let loaded = false;
		
		let image = new Image();
		image.src = 'images/kitty.png';

		let inventory = new Image();
		inventory.src = 'images/inventory.png';

		let milk = new Image();
		milk.src = 'trash/milk_gallon.png';

		let light = new Image();
		light.src = 'trash/light_bulb.png'
		
		//sprite frame counter 		
		let frameCol = 0;
		let frameRow = 0;
		
		let x = canvas.width / 2.13;
		let y = canvas.height / 2.13;
		let sizex = 192/4;
		let sizey = 192/4;
		
		let rightKey = false; //only for Canvas#2
		let leftKey = false;
		let upKey = false;
		let downKey = false;
		let gKey = false;
		let pKey = false

		let trashes = [
			{
				x:500,
				y:400,
				width:30, //de 1 a 10 Math.floor(Math.random() * 10) + 1
				height:30,
				src:milk,
				inventory:false,
				trash:'yellow',
			},
			{
				x:400,
				y:400,
				width:30, //de 1 a 10 Math.floor(Math.random() * 10) + 1
				height:30,
				src:light,
				inventory:false,
				trash:'blue',
			},
		]

		
		const positions = [
			{
				x:638,
				y:589,
				full:false,
			},
			{
				x:688,
				y:589,
				full:false,
			},
			{
				x:736,
				y:589,
				full:false,
			},
			{
				x:785,
				y:589,
				full:false,
			},
			{
				x:832,
				y:589,
				full:false,
			},
		]
		
		// ------------------------------

		class Trash {
			constructor(src, x, y) {    // CONSTRUCTOR
				src = ''
				this.x = Math.random() * 256;
				this.y = Math.random() * 256;
			}

			draw() {
				ctx.beginPath();
                ctx.rect(this.x, this.y, 30, 30);
                ctx.drawImage(this.src, this.x, this.y, 30, 30);
			}
		}

		function init() {
			//setup 50 balls
			for (let i = 0; i < 10; i++) {
				let xInit = 10 + Math.random() * (canvas.width - 2 * 10);
				let yInit = 10 + Math.random() * (canvas.height - 2 * 10);

				// push new object into array
				b.push(new Ball(src, xInit, yInit,30, 30))
			}
		}

		// ------------------------------
		
		//handler for keydown
		function ArrowPressed(e) {
			e.preventDefault();
			if (e.key == 'ArrowRight') {
				rightKey = true; //Canvas#2
			}
			else if (e.key == 'ArrowLeft'){
				leftKey = true; //Canvas#
			}
			else if (e.key == 'ArrowUp') {
				upKey = true; //Canvas#2
			}
			else if (e.key == 'ArrowDown'){
				downKey = true; //Canvas#
			}
			else if(e.keyCode==71){
				gKey = true;
			}
			else if(e.keyCode==80){
				
				sizex = 96/2
				sizey = 576/12
				if (!pKey)
				image.src = 'images/actions.png'
				pKey = true;
			}
		}

		//handler for keyup
		function ArrowReleased(e) {
			if (e.key == 'ArrowRight'){
				rightKey = false;
				frameCol = 0;
			}
			else if (e.key == 'ArrowLeft'){
				leftKey = false;
				frameCol = 0;
			}
			else if (e.key == 'ArrowUp'){
				upKey = false;
				frameCol = 0;
			}
			else if (e.key == 'ArrowDown'){
				downKey = false;
				frameCol = 0;
			}
			else if (e.keyCode == 71){
				gKey = false;
				frameCol = 0;
			}
		}
		
		//sets handlers for events keydown & keyup
		window.addEventListener('keydown', ArrowPressed);
		window.addEventListener('keyup', ArrowReleased);
		
		function grab(x,y){
			trashes.forEach(trash =>{
                if(trash.x>=x && trash.x<=x+192/2 && trash.y>=y && trash.y<=y+192/2){
					let newPos=positions.find(position => position.full==false)
					trash.x=newPos.x
					trash.y=newPos.y
					trash.inventory=true
					let i=positions.indexOf(newPos)
					positions[i].full=true
				}
            })
		}
		
		function render() {
			ctx.clearRect(0, 0, canvas.width, canvas.height);
			ctx.drawImage(inventory,0,0,192,64,W/2-(192*1.8)/2,H-120,192*1.8,64*1.8)
			trashes.forEach(trash =>{
                ctx.beginPath();
                ctx.rect(trash.x, trash.y, trash.width, trash.height);
                ctx.drawImage(trash.src, trash.x, trash.y,trash.width, trash.height);
            })
			if (rightKey && x < canvas.width - 50){
				frameRow = 3;
				x+=10;
				frameCol++;	
				if (frameCol == 4)
				frameCol = 2;
			}
			else if (leftKey && x > 10){
				x-=10;
				frameRow = 2;
				frameCol++;	
				if (frameCol == 4)
				frameCol = 0;
			}
			else if (upKey && y > 10){
				y-=10;
				frameRow = 1;
				frameCol++;	
				if (frameCol == 4)
				frameCol = 0;
			}
			else if (downKey && y < canvas.height - 50){
				y+=10;
				frameRow = 0;
				frameCol++;	
				if (frameCol == 4)
				frameCol = 0;
			}
			else if (gKey){
				frameCol++;	
				if (frameCol == 2)
					frameCol = 0;
				grab(x,y)
				}
				else if (pKey){
					if (frameRow < 8){
						frameRow += 8
						frameCol = 2
					}
					frameCol--;	
					if (frameCol == -1){
						pKey = false;
						image.src = 'images/kitty.png'
						frameCol = 0;
						sizex = 192/4
						sizey = 192/4
						frameRow -= 8
					}
					
				}
				ctx.drawImage(image, frameCol * sizex, frameRow * sizey, sizex, sizey, x, y, 192/2,192/2);
				loadImage(menu)
				console.log(x, y)
				
			}			
			
			
			window.onload = function () {
				loaded = true
				setInterval(render, 1000 / 10);
			};

			function renderTrash(){
				
			}
			
			function main() {
				let a = Math.random()*(canvas.width-50)
				let b = Math.random()*(canvas.height-100)
					ctx.drawImage(menu, a, b);
				}
			
				var item = new Image();
				item.src = 'trash/rubber_duck.png'
				var menu = loadImage('trash/mustard.png', main);

				function loadImage(src, onload) {
					var img = new Image();
					img.onload = onload;
					img.src = src;
					return img;
				}
	</script>
</body>

</html>