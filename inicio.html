<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style type="text/css">
        body {
            background-color: #9BD4C3
        }
    </style>
</head>
<body>
    <div style = "text-align:center;">
        <canvas id="myCanvas" width="1500" height="666">
            Your browser does not support HTML5 Canvas.
        </canvas>
    </div>
	<script>
		const canvas = document.querySelector('#myCanvas');
		const ctx = canvas.getContext("2d");

        let frameCol = 0;
        let frameRow = 0;

        let xbg = 0;
        
		const W = canvas.width, H = canvas.height;
        let rightKey=false, leftKey=false, upKey=false, downKey=false, gKey=false;

		let button = new Image();
		button.src = 'images/button2.png';

        let kitty = new Image();
		kitty.src = 'images/kitty.png';

        let bg = new Image();
		bg.src = 'images/bginicio.png';

		window.onload = function () {
			setInterval(render, 1000 / 4);
		};

        let x=W/2
        let y=H/2

        const rectangles = [
            {
                x: x,
                y: y+50,
                width: 192,
                height: 64,
                sx: 0,
                sy: 64/2,
                sWidth: 192/2,
                sHeight: 64/2,
                dx: x-192/2,
                dy: y-64/2+50,
                page:'./game.html',
                sxClick:192/2,
                syClick:64/2,
                src: button
            },
            {
                x: x,
                y: y+150,
                width: 192,
                height: 64,
                sx: 0,
                sy: 0,
                sWidth: 192/2,
                sHeight: 64/2,
                dx: x-192/2,
                dy: y-64/2 + 150,
                page:'./regras.html',
                sxClick:192/2,
                syClick:0,
                src: button
            }
        ]

        
        function render(){
            ctx.clearRect(0, 0, W, H);

            // o bg poderia ser um elemento do canvas para animar mais tarde
            ctx.drawImage(bg, xbg, 2, 752, 336, 0, 0, canvas.width*1.5,canvas.height*1.5);
            
            // animation for background
            console.log(xbg)
            xbg ++;
            if(xbg == 250){
                xbg = 0;
            }

            rectangles.forEach(rectangle =>{
                ctx.beginPath();
                ctx.drawImage(kitty, frameCol * 192/4, frameRow * 192/4, 192/4, 192/4, canvas.width/2.3, canvas.height/5, 192,192);
                ctx.rect(rectangle.x, rectangle.y, rectangle.width, rectangle.height);
                ctx.drawImage(rectangle.src, rectangle.sx, rectangle.sy,rectangle.sWidth, rectangle.sHeight, rectangle.dx, rectangle.dy, rectangle.width, rectangle.height)

				frameCol++;	
				if (frameCol == 4){
                    frameRow++;
                    frameCol = 0;
                    if (frameRow == 4){
                        frameRow = 0;
                    }
                }
            })
        }
        
        
        function isIntersect(pos,rectangle){
            return rectangle.dx<pos.x && pos.x<rectangle.dx+rectangle.width && rectangle.dy<pos.y && pos.y<rectangle.dy+rectangle.height
        }

        canvas.addEventListener('click', (e)=>{
            console.log('ok');
            const pos={
                x: e.clientX,
                y: e.clientY
            };

            
            rectangles.forEach(rectangle=>{
                console.log(pos)
                console.log(rectangle.x, rectangle.y)
                if(isIntersect(pos, rectangle)){
                    console.log('ok2')
                    rectangle.sx=192/2
                    window.setTimeout(function(){
                        rectangle.sx=0
                    }, 250);
                    window.setTimeout(function(){
                    window.location.href = rectangle.page;
                    }, 500);
                
                }
            })
        })

        

        canvas.addEventListener('mousemove', e => {
				x = e.offsetX; y = e.offsetY;

				console.log(x,y)
			});


	</script>
    
</body>
</html>